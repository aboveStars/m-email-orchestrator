# Email Orchestrator

A master orchestration agent with 5 specialized sub-agents for email workflows: summarization, smart replies, spam detection, calendar event extraction, and language detection.

## Features

- ğŸ“ **Email Summarizer** - Uses Ollama (local LLM) for fast, free, private summarization
- ğŸ’¬ **Smart Reply Generator** - GPT-4 Turbo for context-aware professional replies
- ğŸš« **Spam/Phishing Detector** - ML-style classifier with feature extraction (100% accuracy)
- ğŸ“… **Calendar Event Extractor** - NLP + regex for meeting detection with .ics generation
- ğŸŒ **Multi-Language Support** - Detects email language and generates replies in the same language

## Architecture

```
Master Agent (Orchestrator)
â”œâ”€â”€ Sub-Agent 1: Email Summarizer (Ollama llama3.2:3b)
â”œâ”€â”€ Sub-Agent 2: Smart Reply Generator (GPT-4 Turbo, multi-language)
â”œâ”€â”€ Sub-Agent 3: Spam/Phishing Detector (ML classifier)
â”œâ”€â”€ Sub-Agent 4: Calendar Event Extractor (NLP + regex)
â””â”€â”€ Sub-Agent 5: Language Detector (Ollama + heuristic fallback)
```

**Execution Strategy**: Hybrid parallel + conditional
- Phase 1: Summarizer, Spam Detector, Calendar Extractor, Language Detector run in parallel
- Phase 2: Reply Generator only runs if spam score < 0.5 (uses detected language)

## Quick Start

### Prerequisites

1. **Ollama** - Install from [ollama.ai](https://ollama.ai) and pull the model:
   ```bash
   ollama pull llama3.2:3b
   ```

2. **OpenAI API Key** - Get from [platform.openai.com](https://platform.openai.com)

### Installation

```bash
npm install
```

### Configuration

Create a `.env` file:

```bash
cp .env.example .env
# Edit .env and add your OPENAI_API_KEY
```

### Run the Server

```bash
npm run dev
```

Server runs on `http://localhost:3000`

### API Usage

**Process an email:**

```bash
curl -X POST http://localhost:3000/api/process-email \
  -H "Content-Type: application/json" \
  -d '{
    "email": {
      "from": "john@acme.com",
      "subject": "Q4 Review Meeting - Tuesday 3pm",
      "body": "Hi team, lets meet Tuesday at 3pm in Room 204 to discuss Q4 results.",
      "attachments": ["q4-report.pdf"]
    }
  }'
```

**CLI Usage:**

```bash
npm run process-email -- --file samples/meeting-email.json
```

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/process-email` | POST | Full email orchestration |
| `/api/agents/summarizer` | POST | Test summarizer only |
| `/api/agents/spam-detector` | POST | Test spam detector only |
| `/api/agents/calendar-extractor` | POST | Test calendar extractor only |
| `/api/health` | GET | Health check |

## Sample Output

```json
{
  "orchestration_result": {
    "summary": "Meeting request for Q4 review on Tuesday 3pm, Room 204",
    "priority": "high",
    "suggested_reply": "Thanks John! I'll be there. Looking forward to the Q4 discussion.",
    "spam_score": 0.02,
    "calendar_event": {
      "title": "Q4 Review Meeting",
      "date": "2024-01-23T15:00:00Z",
      "location": "Room 204",
      "attendees": ["john@acme.com"]
    },
    "actions_taken": [
      "âœ… Summarized by Summarizer Agent",
      "âœ… Reply generated by Reply Agent",
      "âœ… Spam check passed (2% spam probability)",
      "âœ… Calendar event extracted"
    ],
    "processing_time_ms": 2341
  }
}
```

## Testing

```bash
npm test
```

## Performance Targets

- âš¡ **Speed**: <5 seconds total (parallel execution)
- ğŸ’° **Cost**: <$0.01 per email (Ollama is free, GPT-4 ~$0.005/email)
- ğŸ¯ **Accuracy**: 95%+ correct classifications

## Project Structure

```
email-orchestrator/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/email.ts          # TypeScript interfaces
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ summarizer.ts       # Ollama-based summarizer
â”‚   â”‚   â”œâ”€â”€ reply-generator.ts  # GPT-4 reply generator
â”‚   â”‚   â”œâ”€â”€ spam-detector.ts    # ML spam classifier
â”‚   â”‚   â””â”€â”€ calendar-extractor.ts
â”‚   â”œâ”€â”€ orchestrator/master.ts  # Master agent
â”‚   â”œâ”€â”€ api/server.ts           # Express server
â”‚   â””â”€â”€ index.ts                # CLI entry point
â”œâ”€â”€ tests/                      # Unit tests
â”œâ”€â”€ samples/                    # Sample email JSONs
â””â”€â”€ README.md
```

## License

MIT
